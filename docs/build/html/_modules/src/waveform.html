
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>src.waveform &#8212; Beautiful Flicker 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for src.waveform</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Handles Flicker Waveform Data</span>

<span class="sd">The class and methods contained herein allow you to generate flicker waveforms and </span>
<span class="sd">perform relevant calculations, including flicker index, frequency, and percent. </span>
<span class="sd">Plots can also be generated directly from the waveform.</span>

<span class="sd">It is recommended to simply create instances of the Waveform class, as opposed to </span>
<span class="sd">using methods outside the class, as this will automatically perform all necessary</span>
<span class="sd">calculations on initialization. In addition, class methods are easily callable</span>
<span class="sd">(e.g. Waveform.plot(), Waveform.get_frequency())</span>

<span class="sd">The class is:</span>

<span class="sd">    * Waveform - A class used to represent a flicker waveform</span>

<span class="sd">The functions are:</span>

<span class="sd">    * import_waveform_csv - Imports a waveform from a CSV file, typically produced by an oscilloscope</span>
<span class="sd">    * denoise - Applies the Savitzky-Golay Filter to remove noise</span>
<span class="sd">    * framerate - Gets the frame rate (samples per second) of the data</span>
<span class="sd">    * find_nearest_idx - Finds the index of the nearest value in an array</span>
<span class="sd">    * find_nearest_idx_rising - Finds the closest rising-edge value in a 1D array</span>
<span class="sd">    * frequency - Calculates the dominant frequency of the waveform</span>
<span class="sd">    * percent_flicker - Computes the flicker percentage of the waveform</span>
<span class="sd">    * flicker_index - Gets the flicker index of the waveform</span>
<span class="sd">    * n_periods - Truncates a waveform to n periods</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="k">import</span> <span class="n">savgol_filter</span><span class="p">,</span> <span class="n">blackmanharris</span><span class="p">,</span> <span class="n">argrelextrema</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="k">import</span> <span class="n">simps</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">round_output</span>
<span class="kn">from</span> <span class="nn">.plot</span> <span class="k">import</span> <span class="n">waveform_graph</span>


<div class="viewcode-block" id="Waveform"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform">[docs]</a><span class="k">class</span> <span class="nc">Waveform</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A class used to represent a flicker waveform</span>

<span class="sd">    This class should be used in lieu of the other functions in this file, as all </span>
<span class="sd">    necessary computations are completed in initialization (waveform import from CSV)</span>
<span class="sd">    and class methods are easily callable (e.g. Waveform.plot(), Waveform.get_frequency())</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    name : str</span>
<span class="sd">        The name of the waveform. Use this to keep track of multiple waveforms and for plotting</span>
<span class="sd">    data : ndarray</span>
<span class="sd">        The 2D array holding waveform data. Format is [time(seconds):float, voltage:float]</span>
<span class="sd">    denoised : bool</span>
<span class="sd">        Whether or not the waveform has been filtered to remove noise</span>
<span class="sd">    framerate : int</span>
<span class="sd">        The number of samples per second of the waveform</span>
<span class="sd">    v_max : float</span>
<span class="sd">        The maximum voltage</span>
<span class="sd">    v_min : float</span>
<span class="sd">        The minimum voltage</span>
<span class="sd">    v_avg : float</span>
<span class="sd">        The average voltage (mean of v_max and v_min)</span>
<span class="sd">    v_pp : float</span>
<span class="sd">        The peak-to-peak voltage (v_max - v_min)</span>
<span class="sd">    frequency : float</span>
<span class="sd">        The dominant flicker frequency, in Hertz</span>
<span class="sd">    period : float</span>
<span class="sd">        The period (1 / frequency), in seconds</span>
<span class="sd">    one_period : ndarray</span>
<span class="sd">        A 2D array containing just one period of the waveform. </span>
<span class="sd">        Format is [time(seconds):float, voltage:float]</span>
<span class="sd">    flicker_index : float</span>
<span class="sd">        The flicker index of the waveform</span>
<span class="sd">    percent_flicker : float</span>
<span class="sd">        The percent flicker of the waveform</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    get_name()</span>
<span class="sd">        Gets the name of this waveform instance</span>
<span class="sd">    get_data()</span>
<span class="sd">        Gets the 2D array containing waveform data</span>
<span class="sd">    get_framerate()</span>
<span class="sd">        Gets the framerate (samples per second) of the data</span>
<span class="sd">    get_denoised()</span>
<span class="sd">        Whether this waveform has been filtered for noise</span>
<span class="sd">    get_v_max(rounded=True, digits=2)</span>
<span class="sd">        Gets the maximum voltage of this waveform instance</span>
<span class="sd">    get_v_min(rounded=True, digits=2)</span>
<span class="sd">        Gets the minimum voltage of this waveform instance</span>
<span class="sd">    get_v_pp(rounded=True, digits=2)</span>
<span class="sd">        Gets the peak-to-peak voltage of this waveform instance</span>
<span class="sd">    get_v_avg(rounded=True, digits=2)</span>
<span class="sd">        Gets the average voltage of this waveform instance</span>
<span class="sd">    get_frequency(rounded=True, digits=1)</span>
<span class="sd">        Gets the flicker frequency of this waveform instance</span>
<span class="sd">    get_period()</span>
<span class="sd">        Gets the period of one oscillation of this waveform instance</span>
<span class="sd">    get_one_period()</span>
<span class="sd">        Gets the 2D array containing one period of the waveform data</span>
<span class="sd">    get_n_periods(num_periods=1)</span>
<span class="sd">        Gets the 2D array containing the specified number of periods in the waveform data</span>
<span class="sd">    get_percent_flicker(rounded=True, digits=1)</span>
<span class="sd">        Gets the percent flicker of this instance of the waveform</span>
<span class="sd">    get_flicker_index(rounded=True, digits=1)</span>
<span class="sd">        Gets the flicker index of this instance of the waveform</span>
<span class="sd">    plot(num_periods=None, filename=None, showstats=True, fullheight=False, figsize=(8,4))</span>
<span class="sd">        Plots the time-series waveform graphic</span>
<span class="sd">    get_summary(verbose=False, format=&#39;String&#39;, rounded=True)</span>
<span class="sd">        Returns a summary of the parameters of this waveform instance</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">remove_noise</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes this Waveform instance and automatically computes all values</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            The name of the CSV file to import</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the waveform. Use this to keep track of multiple waveforms and for plotting</span>
<span class="sd">        remove_noise : bool</span>
<span class="sd">            If True (default), data will be automatically denoised</span>
<span class="sd">            If False, data will not be denoised</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">import_waveform_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">remove_noise</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">denoise</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">denoised</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">denoised</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">framerate</span> <span class="o">=</span> <span class="n">framerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_pp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">v_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_min</span><span class="p">])</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">frequency</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">framerate</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_avg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">one_period</span> <span class="o">=</span> <span class="n">n_periods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_avg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span> <span class="n">num_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flicker_index</span> <span class="o">=</span> <span class="n">flicker_index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">one_period</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_avg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">percent_flicker</span> <span class="o">=</span> <span class="n">percent_flicker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_max</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_min</span><span class="p">)</span>


<div class="viewcode-block" id="Waveform.get_name"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the name of this waveform instance</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The name of this waveform instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>

<div class="viewcode-block" id="Waveform.get_data"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the 2D array containing waveform data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ndarray</span>
<span class="sd">            The 2D array holding waveform data. Format is [time(seconds):float, voltage:float]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span></div>


<div class="viewcode-block" id="Waveform.get_framerate"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_framerate">[docs]</a>    <span class="k">def</span> <span class="nf">get_framerate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the framerate (samples per second) of the data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The number of samples per second of the waveform</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">framerate</span></div>


<div class="viewcode-block" id="Waveform.get_denoised"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_denoised">[docs]</a>    <span class="k">def</span> <span class="nf">get_denoised</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Whether this waveform has been filtered for noise</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if the waveform has been denoised, False if not</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">denoised</span></div>


<div class="viewcode-block" id="Waveform.get_v_max"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_v_max">[docs]</a>    <span class="k">def</span> <span class="nf">get_v_max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rounded</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">digits</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the maximum voltage of this waveform instance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rounded : bool</span>
<span class="sd">            If True (default), will round the output</span>
<span class="sd">            If False, will not round the output</span>
<span class="sd">        digits : int</span>
<span class="sd">            The number of decimal points to round to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The max voltage</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">round_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_max</span><span class="p">,</span> <span class="n">rounded</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span></div>


<div class="viewcode-block" id="Waveform.get_v_min"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_v_min">[docs]</a>    <span class="k">def</span> <span class="nf">get_v_min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rounded</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">digits</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the minimum voltage of this waveform instance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rounded : bool</span>
<span class="sd">            If True (default), will round the output</span>
<span class="sd">            If False, will not round the output</span>
<span class="sd">        digits : int</span>
<span class="sd">            The number of decimal points to round to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The min voltage</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">round_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_min</span><span class="p">,</span> <span class="n">rounded</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span></div>


<div class="viewcode-block" id="Waveform.get_v_pp"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_v_pp">[docs]</a>    <span class="k">def</span> <span class="nf">get_v_pp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rounded</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">digits</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the peak-to-peak voltage of this waveform instance</span>

<span class="sd">        Peak-to-peak voltage is v_max - v-min</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rounded : bool</span>
<span class="sd">            If True (default), will round the output</span>
<span class="sd">            If False, will not round the output</span>
<span class="sd">        digits : int</span>
<span class="sd">            The number of decimal points to round to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The peak-to-peak voltage</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">round_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_pp</span><span class="p">,</span> <span class="n">rounded</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span></div>


<div class="viewcode-block" id="Waveform.get_v_avg"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_v_avg">[docs]</a>    <span class="k">def</span> <span class="nf">get_v_avg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rounded</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">digits</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the average voltage of this waveform instance</span>

<span class="sd">        Average voltage is the mean of v_max and v_min</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rounded : bool</span>
<span class="sd">            If True (default), will round the output</span>
<span class="sd">            If False, will not round the output</span>
<span class="sd">        digits : int</span>
<span class="sd">            The number of decimal points to round to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The average voltage</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">round_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_avg</span><span class="p">,</span> <span class="n">rounded</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span></div>


<div class="viewcode-block" id="Waveform.get_frequency"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_frequency">[docs]</a>    <span class="k">def</span> <span class="nf">get_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rounded</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">digits</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the flicker frequency of this waveform instance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rounded : bool</span>
<span class="sd">            If True (default), will round the output</span>
<span class="sd">            If False, will not round the output</span>
<span class="sd">        digits : int</span>
<span class="sd">            The number of decimal points to round to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The flicker frequency in Hertz</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">round_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frequency</span><span class="p">,</span> <span class="n">rounded</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span></div>


<div class="viewcode-block" id="Waveform.get_period"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_period">[docs]</a>    <span class="k">def</span> <span class="nf">get_period</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the period of one oscillation of this waveform instance</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The period in seconds</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">period</span></div>


<div class="viewcode-block" id="Waveform.get_one_period"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_one_period">[docs]</a>    <span class="k">def</span> <span class="nf">get_one_period</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the 2D array containing one period of the waveform data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ndarray</span>
<span class="sd">            The 2D array holding one period of the waveform. </span>
<span class="sd">            Format is [time(seconds):float, voltage:float]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_period</span></div>


<div class="viewcode-block" id="Waveform.get_n_periods"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_n_periods">[docs]</a>    <span class="k">def</span> <span class="nf">get_n_periods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_periods</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the 2D array containing the specified number of periods in the waveform data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_periods : int</span>
<span class="sd">            The number of periods to return.</span>
<span class="sd">            NOTE: Must be fewer than the number of periods in the input data</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ndarray</span>
<span class="sd">            The 2D array holding the specified number of periods of the waveform data. </span>
<span class="sd">            Format is [time(seconds):float, voltage:float]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">num_periods</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">one_period</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n_periods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_avg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">period</span><span class="p">,</span> <span class="n">num_periods</span><span class="p">)</span></div>


<div class="viewcode-block" id="Waveform.get_percent_flicker"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_percent_flicker">[docs]</a>    <span class="k">def</span> <span class="nf">get_percent_flicker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rounded</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">digits</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the percent flicker of this instance of the waveform</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rounded : bool</span>
<span class="sd">            If True (default), will round the output</span>
<span class="sd">            If False, will not round the output</span>
<span class="sd">        digits : int</span>
<span class="sd">            The number of decimal points to round to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The percent flicker (will be in the format XX.XXXX, NOT 0.XXXXXX)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">round_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">percent_flicker</span><span class="p">,</span> <span class="n">rounded</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span></div>


<div class="viewcode-block" id="Waveform.get_flicker_index"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_flicker_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_flicker_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rounded</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">digits</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Gets the flicker index of this instance of the waveform</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rounded : bool</span>
<span class="sd">            If True (default), will round the output</span>
<span class="sd">            If False, will not round the output</span>
<span class="sd">        digits : int</span>
<span class="sd">            The number of decimal points to round to</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The flicker index</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">round_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flicker_index</span><span class="p">,</span> <span class="n">rounded</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span></div>


<div class="viewcode-block" id="Waveform.plot"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_periods</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showstats</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
             <span class="n">fullheight</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="p">:</span><span class="nb">tuple</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">4</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the time-series waveform graphic</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_periods : int or None</span>
<span class="sd">            The number of periods to plot. If None, will show the whole waveform</span>
<span class="sd">        filename : str or None</span>
<span class="sd">            If specified, will save the file in the specified location.</span>
<span class="sd">            e.g.: filename=&#39;../out/this_graph.png&#39;</span>
<span class="sd">            If None, the plot will not be saved</span>
<span class="sd">        showstats : bool</span>
<span class="sd">            If True, will show the flicker frequency, percent, and index on the plot</span>
<span class="sd">        fullheight : bool</span>
<span class="sd">            If True, will set the Y axis limits from 0 to 1.</span>
<span class="sd">            If False, will set the limits from v_min to 1</span>
<span class="sd">        figsize : tuple</span>
<span class="sd">            The (x,y) size of the figure</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">waveform_graph</span><span class="p">(</span><span class="n">waveform</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_periods</span><span class="o">=</span><span class="n">num_periods</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="n">showstats</span><span class="o">=</span><span class="n">showstats</span><span class="p">,</span> \
                       <span class="n">fullheight</span><span class="o">=</span><span class="n">fullheight</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span></div>


<div class="viewcode-block" id="Waveform.get_summary"><a class="viewcode-back" href="../../index.html#src.waveform.Waveform.get_summary">[docs]</a>    <span class="k">def</span> <span class="nf">get_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s1">&#39;String&#39;</span><span class="p">,</span> <span class="n">rounded</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a summary of the parameters of this waveform instance</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        verbose : bool</span>
<span class="sd">            If False, will display: </span>
<span class="sd">                Frequency, Percent Flicker, Flicker Index (and Name for dict format)</span>
<span class="sd">            If True, will display all of the above, plus:</span>
<span class="sd">                Period, Frame Rate, V_min, V_max, V_avg, V_pp</span>
<span class="sd">        format : str</span>
<span class="sd">            The format of the output, either &#39;String&#39; or &#39;Dict&#39;</span>
<span class="sd">        rounded : bool</span>
<span class="sd">            If True (default), will round the output values</span>
<span class="sd">            If False, will not round the output values</span>

<span class="sd">        Returns:</span>
<span class="sd">        str or dict</span>
<span class="sd">            If format = &#39;String&#39;: A String summarizing the waveform</span>
<span class="sd">            If format = &#39;Dict&#39;: A dict summarizing the waveform</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;String&#39;</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s2">&quot;Frequency: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_frequency</span><span class="p">(</span><span class="n">rounded</span><span class="o">=</span><span class="n">rounded</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; Hz</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                <span class="s2">&quot;Percent Flicker: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_percent_flicker</span><span class="p">(</span><span class="n">rounded</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;%</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                <span class="s2">&quot;Flicker Index: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_flicker_index</span><span class="p">(</span><span class="n">rounded</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Period: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_period</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot; s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                    <span class="s2">&quot;Frame Rate: &quot;</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="si">{:,}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_framerate</span><span class="p">())</span> <span class="o">+</span> <span class="s2">&quot; samples per second</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                    <span class="s2">&quot;V_min: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_v_min</span><span class="p">(</span><span class="n">rounded</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; V</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                    <span class="s2">&quot;V_max: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_v_max</span><span class="p">(</span><span class="n">rounded</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; V</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                    <span class="s2">&quot;V_avg: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_v_avg</span><span class="p">(</span><span class="n">rounded</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; V</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> \
                    <span class="s2">&quot;V_pp: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_v_pp</span><span class="p">(</span><span class="n">rounded</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; V&quot;</span>

        <span class="k">elif</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;Dict&#39;</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;frequency&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_frequency</span><span class="p">(</span><span class="n">rounded</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;percent flicker&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_percent_flicker</span><span class="p">(</span><span class="n">rounded</span><span class="p">)</span>
            <span class="n">out</span><span class="p">[</span><span class="s1">&#39;flicker index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_flicker_index</span><span class="p">(</span><span class="n">rounded</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_period</span><span class="p">()</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;frame rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_framerate</span><span class="p">()</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;v_min&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_v_min</span><span class="p">(</span><span class="n">rounded</span><span class="p">)</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;v_max&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_v_max</span><span class="p">(</span><span class="n">rounded</span><span class="p">)</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;v_avg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_v_avg</span><span class="p">(</span><span class="n">rounded</span><span class="p">)</span>
                <span class="n">out</span><span class="p">[</span><span class="s1">&#39;v_pp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_v_pp</span><span class="p">(</span><span class="n">rounded</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="s1">&#39;Unidentified data format&#39;</span>

        <span class="k">return</span> <span class="n">out</span></div></div>


<div class="viewcode-block" id="import_waveform_csv"><a class="viewcode-back" href="../../index.html#src.waveform.import_waveform_csv">[docs]</a><span class="k">def</span> <span class="nf">import_waveform_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Imports a waveform from a CSV file, typically produced by an oscilloscope</span>

<span class="sd">    NOTE: Format should be [time(seconds), volts] and header info should be removed</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        The name of the CSV file</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        A 2D numpy array in the format [time(seconds), volts]    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Import from the file</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

    <span class="c1"># Set the time axis to 0</span>
    <span class="n">t_0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">data</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">t_0</span> 

    <span class="k">return</span> <span class="n">data</span></div>


<div class="viewcode-block" id="denoise"><a class="viewcode-back" href="../../index.html#src.waveform.denoise">[docs]</a><span class="k">def</span> <span class="nf">denoise</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">window_length</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1001</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Applies the Savitzky-Golay Filter to remove noise</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : ndarray</span>
<span class="sd">        The waveform data as a 2D array</span>
<span class="sd">    window_length : int</span>
<span class="sd">        The window length for the filter. Higher equals more smoothing</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        The waveform with noise removed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">data2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">data2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">window_length</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data2</span></div>


<div class="viewcode-block" id="framerate"><a class="viewcode-back" href="../../index.html#src.waveform.framerate">[docs]</a><span class="k">def</span> <span class="nf">framerate</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Gets the frame rate (samples per second) of the data</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : ndarray</span>
<span class="sd">        The waveform data as a 2D array</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        The number of samples per second in the data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])))</span></div>


<div class="viewcode-block" id="find_nearest_idx"><a class="viewcode-back" href="../../index.html#src.waveform.find_nearest_idx">[docs]</a><span class="k">def</span> <span class="nf">find_nearest_idx</span><span class="p">(</span><span class="n">array</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Finds the index of the nearest value in an array</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    array : ndarray</span>
<span class="sd">        A 1D array to search</span>
<span class="sd">    value : float</span>
<span class="sd">        The closest value to search for in the array</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        The first index of the array value that is closest to the search value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">array</span><span class="o">-</span><span class="n">value</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span></div>


<div class="viewcode-block" id="find_nearest_idx_rising"><a class="viewcode-back" href="../../index.html#src.waveform.find_nearest_idx_rising">[docs]</a><span class="k">def</span> <span class="nf">find_nearest_idx_rising</span><span class="p">(</span><span class="n">array</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span><span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Finds the closest rising-edge value in a 1D array</span>
<span class="sd">    </span>
<span class="sd">    This function is primarily used to find the start of a period.</span>
<span class="sd">    It recursively calls find_nearest_index()</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    array : ndarray</span>
<span class="sd">        A 1D array to search</span>
<span class="sd">    value : float</span>
<span class="sd">        The closest value to search for in the array</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        The first index of the array value that is both closest to the search value and on a rising edge</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="n">find_nearest_idx</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">array</span><span class="p">[</span><span class="n">idx</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">array</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">array</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
        <span class="c1"># Got a rising edge, return</span>
        <span class="k">return</span> <span class="n">idx</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Slice the array so we can find the next index</span>
        <span class="n">new_array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># Recursively run this function until a rising edge is found</span>
        <span class="k">return</span> <span class="n">find_nearest_idx_rising</span><span class="p">(</span><span class="n">new_array</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="frequency"><a class="viewcode-back" href="../../index.html#src.waveform.frequency">[docs]</a><span class="k">def</span> <span class="nf">frequency</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">framerate</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">v_avg</span><span class="p">:</span><span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Calculates the dominant frequency of the waveform</span>
<span class="sd">    </span>
<span class="sd">    Uses the zero-crossing method for fast and accurate frequency calculation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : ndarray</span>
<span class="sd">        The waveform data as a 2D array</span>
<span class="sd">    framerate : int</span>
<span class="sd">        The frame rate (samples per second)</span>
<span class="sd">    v_avg : float</span>
<span class="sd">        The average voltage</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The frequency in Hertz</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Center the data on zero</span>
    <span class="n">zdata</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v_avg</span>

    <span class="c1"># Count the zero crossings</span>
    <span class="n">zero_crossings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">zdata</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Linear interpolation</span>
    <span class="k">return</span> <span class="n">framerate</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">zero_crossings</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span></div>


<div class="viewcode-block" id="percent_flicker"><a class="viewcode-back" href="../../index.html#src.waveform.percent_flicker">[docs]</a><span class="k">def</span> <span class="nf">percent_flicker</span><span class="p">(</span><span class="n">v_max</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">v_pp</span><span class="p">:</span><span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Computes the flicker percentage of the waveform</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    v_max : float</span>
<span class="sd">        The max voltage</span>
<span class="sd">    v_pp : float</span>
<span class="sd">        The peak-to-peak voltage</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The flicker percentage</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">v_pp</span> <span class="o">/</span> <span class="n">v_max</span> <span class="o">*</span> <span class="mi">100</span></div>


<div class="viewcode-block" id="flicker_index"><a class="viewcode-back" href="../../index.html#src.waveform.flicker_index">[docs]</a><span class="k">def</span> <span class="nf">flicker_index</span><span class="p">(</span><span class="n">one_period</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">v_avg</span><span class="p">:</span><span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Gets the flicker index of the waveform</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    one_period : ndarray</span>
<span class="sd">        One period of the waveform as a 2D array</span>
<span class="sd">    v_avg : float</span>
<span class="sd">        The average voltage</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        The flicker index</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Split the curve across the average</span>
    <span class="n">curve_top</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">v_avg</span> <span class="k">else</span> <span class="n">v_avg</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">one_period</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]]</span>

    <span class="c1"># Subtract the average from the top curve</span>
    <span class="n">curve_top</span> <span class="o">=</span> <span class="n">curve_top</span> <span class="o">-</span> <span class="n">v_avg</span>

    <span class="c1"># Get the area under the curve for the top and all using Simpson&#39;s rule</span>
    <span class="n">area_top</span> <span class="o">=</span> <span class="n">simps</span><span class="p">(</span><span class="n">curve_top</span><span class="p">)</span>
    <span class="n">area_all</span> <span class="o">=</span> <span class="n">simps</span><span class="p">(</span><span class="n">one_period</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Return the flicker index </span>
    <span class="k">return</span> <span class="n">area_top</span> <span class="o">/</span> <span class="n">area_all</span></div>


<div class="viewcode-block" id="n_periods"><a class="viewcode-back" href="../../index.html#src.waveform.n_periods">[docs]</a><span class="k">def</span> <span class="nf">n_periods</span><span class="p">(</span><span class="n">data</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">v_avg</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">period</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">num_periods</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Truncates a waveform to n periods</span>

<span class="sd">    NOTE: The number of periods must be shorter than the input waveform</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : ndarray</span>
<span class="sd">        The waveform data as a 2D array</span>
<span class="sd">    v_avg : float</span>
<span class="sd">        The average voltage</span>
<span class="sd">    period : float</span>
<span class="sd">        The period in seconds</span>
<span class="sd">    num_periods : int</span>
<span class="sd">        The number of periods to return</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ndarray</span>
<span class="sd">        The waveform truncated to the specified number of periods    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Slice the array to the first period (so we can find the rising edge average)</span>
    <span class="n">t_0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_0</span>
    <span class="n">idx_1</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">period</span> <span class="o">/</span> <span class="n">delta</span><span class="p">)</span>
    <span class="n">t_1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">idx_1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Find the first instance of the average</span>
    <span class="n">idx_avg</span> <span class="o">=</span> <span class="n">find_nearest_idx_rising</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">v_avg</span><span class="p">)</span>

    <span class="c1"># Slice the array to the number of periods and return</span>
    <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="n">idx_avg</span><span class="p">:</span><span class="n">idx_avg</span><span class="o">+</span><span class="n">num_periods</span><span class="o">*</span><span class="n">idx_1</span><span class="p">,:]</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Beautiful Flicker</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Greg Yeutter.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>